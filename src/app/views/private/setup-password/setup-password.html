<div class="overlay">
  <div class="modal">
    <!-- Header -->
    <div class="header">
      <div class="titleWrapper">
        <h2 class="title">
          <span class="text-color-primary">[$SIGNUP]</span> Finaliser votre inscription
        </h2>
      </div>
    </div>

    <!-- Subtitle -->
    <p class="subtitle">
      Bienvenue <strong class="text-color-primary">{{ nickname() }}</strong> ! <br>
      Définissez votre mot de passe pour activer votre compte.
    </p>

    <!-- Content -->
    <div class="content">
      @if (auth.error()) {
      <div class="error">⚠️ {{ auth.error() }}</div>
      }

      <form [formGroup]="signupForm" (ngSubmit)="handleSubmit()" class="form">
        <div class="user-info">
          <div class="info-item">
            <span class="label">Nom d'utilisateur :</span>
            <span class="value text-color-primary">{{ nickname() }}</span>
          </div>
          <div class="info-item">
            <span class="label">Email :</span>
            <span class="value text-color-primary">{{ email() }}</span>
          </div>
        </div>

        <div class="inputGroup">
          <label for="password" class="label">Mot de passe</label>
          <div class="password-wrapper">
            <input 
              id="password" 
              [type]="showPassword() ? 'text' : 'password'" 
              formControlName="password" 
              class="input" 
              placeholder="••••••••"
              required />
            <button  type="button"  class="toggle-visibility" (click)="togglePasswordVisibility()" aria-label="Afficher/masquer le mot de passe">
              @if (showPassword()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                  <path fill="currentColor" d="M12 9a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5a5 5 0 0 1 5-5a5 5 0 0 1 5 5a5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/>
                </svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                  <path fill="currentColor" d="M11.83 9L15 12.16V12a3 3 0 0 0-3-3zm-4.3.8l1.55 1.55c-.05.21-.08.42-.08.65a3 3 0 0 0 3 3c.22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53a5 5 0 0 1-5-5c0-.79.2-1.53.53-2.2M2 4.27l2.28 2.28l.45.45C3.08 8.3 1.78 10 1 12c1.73 4.39 6 7.5 11 7.5c1.55 0 3.03-.3 4.38-.84l.43.42L19.73 22L21 20.73L3.27 3M12 7a5 5 0 0 1 5 5c0 .64-.13 1.26-.36 1.82l2.93 2.93c1.5-1.25 2.7-2.89 3.43-4.75c-1.73-4.39-6-7.5-11-7.5c-1.4 0-2.74.25-4 .7l2.17 2.15C10.74 7.13 11.35 7 12 7"/>
                </svg>
              }
            </button>
          </div>
          @if (signupForm.get('password')?.touched && signupForm.get('password')?.invalid) {
          <div class="field-error">
            @if (signupForm.get('password')?.errors?.['required']) {
              Le mot de passe est requis
            } @else if (signupForm.get('password')?.errors?.['minlength']) {
              Minimum 8 caractères
            } @else if (signupForm.get('password')?.errors?.['pattern']) {
              Doit contenir majuscule, minuscule et chiffre
            }
          </div>
          }
        </div>

        <div class="inputGroup">
          <label for="confirmPassword" class="label">Confirmer le mot de passe</label>
          <div class="password-wrapper">
            <input 
              id="confirmPassword" 
              [type]="showConfirmPassword() ? 'text' : 'password'" 
              formControlName="confirmPassword" 
              class="input" 
              placeholder="••••••••"
              required />
            <button 
              type="button" 
              class="toggle-visibility"
              (click)="toggleConfirmPasswordVisibility()"
              aria-label="Afficher/masquer la confirmation">
              @if (showConfirmPassword()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                  <path fill="currentColor" d="M12 9a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5a5 5 0 0 1 5-5a5 5 0 0 1 5 5a5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/>
                </svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                  <path fill="currentColor" d="M11.83 9L15 12.16V12a3 3 0 0 0-3-3zm-4.3.8l1.55 1.55c-.05.21-.08.42-.08.65a3 3 0 0 0 3 3c.22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53a5 5 0 0 1-5-5c0-.79.2-1.53.53-2.2M2 4.27l2.28 2.28l.45.45C3.08 8.3 1.78 10 1 12c1.73 4.39 6 7.5 11 7.5c1.55 0 3.03-.3 4.38-.84l.43.42L19.73 22L21 20.73L3.27 3M12 7a5 5 0 0 1 5 5c0 .64-.13 1.26-.36 1.82l2.93 2.93c1.5-1.25 2.7-2.89 3.43-4.75c-1.73-4.39-6-7.5-11-7.5c-1.4 0-2.74.25-4 .7l2.17 2.15C10.74 7.13 11.35 7 12 7"/>
                </svg>
              }
            </button>
          </div>
          @if (signupForm.get('confirmPassword')?.touched && signupForm.errors?.['passwordMismatch']) {
          <div class="field-error">
            Les mots de passe ne correspondent pas
          </div>
          }
        </div>

        <div class="password-requirements">
          <p class="requirements-title">Votre mot de passe doit contenir :</p>
          <ul class="requirements-list">
            <li [class.valid]="signupForm.get('password')?.value?.length >= 8">
              Au moins 8 caractères
            </li>
            <!-- <li [class.valid]="signupForm.get('password')?.value?.match(/[a-z]/)">
              Au moins une minuscule
            </li>
            <li [class.valid]="signupForm.get('password')?.value?.match(/[A-Z]/)">
              Au moins une majuscule
            </li>
            <li [class.valid]="signupForm.get('password')?.value?.match(/\d/)">
              Au moins un chiffre
            </li> -->
          </ul>
        </div>

        <button
          type="submit"
          class="submitBtn btn btn--primary text-color-white"
          [disabled]="signupForm.invalid || auth.isLoading()">
          @if (auth.isLoading()) {
          <span class="spinner"></span>
          Finalisation...
          } @else {
          ✓ Finaliser mon inscription
          }
        </button>
      </form>
    </div>
  </div>
</div>